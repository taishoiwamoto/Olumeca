<div class="main">
  <div class="table-container">
    <!-- ページのタイトル -->
    <h1>Pedidos realizados</h1>
    <div class="table-responsive">
      <table class="table table-hover">
        <!-- テーブルのヘッダー -->
        <thead>
          <tr>
            <th scope="col">Fecha</th>
            <th scope="col">Estado</th>
            <th scope="col">Evaluación</th>
            <th scope="col">Info</th>
            <th scope="col">Vendedor/a</th>
            <th scope="col">Servicio</th>
          </tr>
        </thead>
        <!-- テーブルのボディ -->
        <tbody>
          <% @orders.each do |order| %>
            <tr>
              <!-- 注文日 -->
              <td><%= order.created_at.strftime("%d/%m/%Y") %></td>
              <!-- 注文の状態 -->
              <td>
                <% case order.status %>
                <% when 'pending' %>
                <%= button_tag get_order_status(order.status), class: "btn btn-secondary btn-sm", disabled: true %>
                <% when 'accepted' %>
                <%= button_tag get_order_status(order.status), class: "btn btn-success btn-sm", disabled: true %>
                <% when 'rejected' %>
                <%= button_tag get_order_status(order.status), class: "btn btn-danger btn-sm", disabled: true %>
              <% end %>
            </td>
            <!-- 評価リンク -->
            <td>
              <% if order.seller.deleted? %>
                N/A
              <% elsif order.accepted? %>
                <!-- この行では、インスタンス変数 @reviews_by_userから特定のサービスIDに一致するレビューを検索します。 -->
                <!-- find メソッドは最初に条件に一致する要素を返します。この場合、order.service_id と一致する service_id を持つレビューを探します。 -->
                <!-- 、|review|はブロック変数として機能し、@reviews_by_userの各要素（各レビュー）を順番にreviewという名前で参照できるようにします。ブロック内のコードはこの変数を使用して条件を評価し、条件に一致する最初の要素を見つけた場合にはその要素を返し、一致するものがない場合はnilを返します。 -->
                <% review_for_order = @reviews_by_user.find { |review| review.service_id == order.service_id } %>
                <% if review_for_order %>
                  <!-- review_for_order 変数が nil ではない場合（つまり、一致するレビューが見つかった場合）、そのレビューを編集するためのリンクを表示します。 -->
                  <%= link_to "Editar", edit_service_review_path(order.service, review_for_order), class: "btn btn-primary btn-sm"  %>
                <% else %>
                  <%= link_to "Evaluar", new_service_review_path(order.service), class: "btn btn-primary btn-sm" %>
                <% end %>
              <% end %>
            </td>
            <!-- 追加情報 -->
            <td>
              <% if order.seller.deleted? || order.pending? || order.rejected? %>
                N/A
              <% elsif order.accepted? %>
                <div class="info-item">
                  <i class="fa-solid fa-envelope"></i>: <%= order.seller.email %>
                </div>
                <div class="info-item">
                  <i class="fa-solid fa-phone"></i>: <%= order.seller.phone_number %>
                </div>
              <% end %>
            </td>
            <!-- 販売者情報 -->
            <td>
              <% if order.service.user.deleted? %>
                Dado de baja
              <% else %>
                <%= link_to order.service.user.name, user_path(order.seller), class: "link-text" %>
              <% end %>
            </td>
            <!-- サービス名 -->
            <td>
              <% if order.service.user.deleted? || order.service.deleted? %>
                Eliminado
              <% else %>
                <%= link_to order.service.title, service_path(order.service), class: "link-text" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <!-- ページネーション -->
  <%= paginate @orders %>
</div>
</div>
