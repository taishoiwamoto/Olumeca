<div class="main">
  <div class="container">
  <h1>Pedidos realizados</h1>
    <div class="table-responsive">
      <%# [優先度: 中] インラインスタイルは避けた方がよいです %>
      <table class="table table-hover" style="border: 1px solid #cbd5d5;">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Servicio</th>
            <th scope="col">Vendedor/a</th>
            <th scope="col">Fecha</th>
            <th scope="col">Estado</th>
            <th scope="col">Evaluación</th>
            <th scope="col">Info</th>
          </tr>
        </thead>
        <tbody>
          <% @orders.each do |order| %>
            <tr>
              <td><%= order.id %></td>
              <td>
                <%# [優先度: 低] `user.deleted_at.nil?`と書くより`user.deleted?`と書く方が、「ユーザが削除されているか？」をより直感的に表せるかと思います。 %>
                <%# models/user.rbにdeleted?メソッドを下記のように定義してみてください %>
                <%# def deleted? %>
                <%#   deleted_at.present? %>
                <%# end %>
                <% if order.service.user.deleted_at.nil? %>
                  <%= link_to order.service.title, service_path(order.service), class: "link-text" %>
                <% else %>
                  <%= order.service.title %>
                <% end %>
              </td>

              <td>
                <% if order.service.user.deleted_at.nil? %>
                  <%= link_to order.service.user.name, user_path(order.seller), class: "link-text" %>
                <% else %>
                  <%= order.service.user.name %>
                <% end %>
              </td>
              <td><%= order.created_at.strftime("%d/%m/%Y") %></td>
              <td>
                <% case order.status %>
                  <% when 'pending' %>
                    <%= button_tag get_order_status(order.status), class: "btn btn-secondary btn-sm", disabled: true %>
                  <% when 'accepted' %>
                    <%= button_tag get_order_status(order.status), class: "btn btn-success btn-sm", disabled: true %>
                  <% when 'rejected' %>
                    <%= button_tag get_order_status(order.status), class: "btn btn-danger btn-sm", disabled: true %>
                <% end %>
              </td>
              <td>
                <% if order.accepted? %>
                  <% if order.service_reviewed_by_user?(current_user.id) %>
                    <%# [優先度: 中] review_by_userがN+1問題を発生させます。%>
                    <%# あらかじめコントローラで当該ユーザが記載したレビュー一覧を取得してください %>
                    <%= link_to "Editar", edit_service_review_path(order.service, order.review_by_user(current_user.id)), class: "btn btn-primary btn-sm"  %>
                  <% else %>
                    <%= link_to "Evaluar", new_service_review_path(order.service), class: "btn btn-primary btn-sm" %>
                  <% end %>
                <% end %>
              </td>
              <td>
                <% if order.accepted? %>
                  <div class="info-item">
                    <%# [優先度: 中] spanの閉じタグがありません %>
                    <%# [優先度: 低] brではなくmarginで行間は調整してください %>
                    <%# [優先度: 高] sellerが退会していた際の考慮がされてないです %>
                    <i class="fa-solid fa-envelope"></i>: <%= order.seller.email %></span> <br/>
                  </div>
                  <div class="info-item">
                    <i class="fa-solid fa-phone"></i>: <%= order.seller.phone_number %></span>
                  </div>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <%= paginate @orders %>
  </div>
</div>
