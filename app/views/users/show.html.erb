<div class="main">
  <div class="container">
    <div class="user-show-container">
      <%# 未対応 %><%# [優先度: 中] インデントがずれてます。またdivの開始とdiv閉じるの個数が異なります。 %>
      <% if @user == current_user %>
        <div class="d-flex justify-content-end align-items-right p-3 mb-0">
          <%= link_to "Editar tu cuenta", edit_user_registration_path, class: "btn btn-primary btn-sm" %>
        </div>
      <% end %>


      <div class="user p-3 mt-0">
        <div class="row align-items-center flex-column flex-md-row">
          <div class="col-12 col-md-auto text-center text-md-start mb-3 mb-md-0">
            <% if @user.image.attached? %>
              <%# 未対応 %><%# [優先度: 中] インデントがずれてます。またdivの開始とdiv閉じるの個数が異なります。 %>
              <%= image_tag(@user.image, class: "img-fluid rounded-circle", alt: @user.name) %>
            <% else %>
              <%= image_tag('default_user.jpg', class: "img-fluid rounded-circle", alt: "Default user image") %>
            <% end %>
          </div>

          <div class="col text-center text-md-start">
            <h2><%= @user.name %></h2>
            <% average_rating = @user.average_service_rating %>
            <% if average_rating > 0 %>
              <div class="average-rating">
                <p><%= "⭐️" %> <%= sprintf('%.2f', average_rating) %></p>
              </div>
            <% else %>
              <p> -- </p>
            <% end %>
          </div>
        </div>
      </div>

      <%# 未対応 %><%# [優先度: 低] hタグはh1から順に使います。基本的にh2を飛ばしてh3を使うなどはしません。文字サイズは見出しの番号ではなくスタイルで制御してください。 %>
      <h5>Servicios</h5>
      <div class="row">
        <% if @services.any? %>
          <% @services.each do |service| %>
            <div class="col-lg-6">
              <%= link_to service_path(service), class: "card-link-wrapper" do %>
                <div class="card mb-4 bg-white" style="width: 100%;">
                  <div class="row g-1">
                    <div class="col-3 d-none d-md-flex align-items-center justify-content-center">
                      <% if service.image.attached? %>
                        <%= image_tag service.image, class: "img-fluid rounded-start", style: "width: 75px; height: 75px; border: 2px solid #EEEEEE;", alt: service.title %>
                      <% else %>
                        <%= image_tag 'default_service.jpg', class: "img-fluid rounded-start", style: "width: 75px; height: 75px; border: 2px solid #EEEEEE;", alt: "Default service image" %>
                      <% end %>
                    </div>

                    <div class="col-8">
                      <div class="card-body">
                        <h5 class="card-title"><%= service.title.truncate(20) %></h5>
                        <div class="star">
                          <% reviews = service.reviews %>
                          <% if reviews.present? %>
                            <% average_rating = service.average_rating %>
                            <p class="card-text"><%= "⭐️" %> <%= sprintf('%.2f', average_rating) %></p>
                          <% else %>
                            <p class="card-text"> -- </p>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <p>No hay servicios.</p>
        <% end %>
      </div>



      <h5>Evaluación</h5>
      <div class="row">
        <% if @reviews.any? %>
          <% @reviews.each do |review| %>
            <div class="col-12 mb-4">
              <div class="card" style="width: 100%;">
                <div class="card-body">
                  <div class="flex-grow-1 mt-3" style="margin-left: 10px;">

                    <%# 未対応 %><%# [優先度: 低] hタグはh1から順に使います。基本的にh2を飛ばしてh3を使うなどはしません。文字サイズは見出しの番号ではなくスタイルで制御してください。 %>
                    <h5 style="margin-top: 10px; word-wrap: break-word; overflow-wrap: break-word;">
                      <%= link_to "Servicio: #{review&.service&.title}", service_path(review&.service), class: "link-class-name link-text" %>
                    </h5>


                    <div class="d-flex align-items-center mt-2">
                      <% if review.user.image.attached? %>
                        <%= image_tag(review.user.image, class: "rounded-circle mr-3", style: "width: 40px; height: 40px;") %>
                      <% else %>
                        <%= image_tag('default_user.jpg', class: "rounded-circle mr-3", style: "width: 40px; height: 40px;") %>
                      <% end %>
                      <% if review.rating.present? %>
                        <div class="ms-2"><%= "⭐️" * review.rating %></div>
                      <% end %>
                    </div>
                    <p class="font-weight-bold mt-2 mb-0">Comprador/a: <%= review.user.name || "Dado de baja" %></p>
                    <%# 未対応 %><%# [優先度: 中] 極力インラインスタイルは避けてください %>
                    <%# 完了 %><%# [優先度: 低] `review.user.name || "Usuario dado de baja"`とするとif文不要になります %>
                    <div class="d-flex justify-content-start mt-2" style="font-size: 12px;">
                      <div style="margin-right: 10px;">Creación: <%= review.created_at.strftime("%d/%m/%Y %H:%M") %></div>
                      <div style="margin-bottom: 10px;">Actualización: <%= review.updated_at.strftime("%d/%m/%Y %H:%M") %></div>
                    </div>
                    <p><%= simple_format(h(review.comment)) %></p>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <p>No hay evaluaciones.</p>
         <% end %>
      </div>
      <%= paginate @reviews %>
    </div>
  </div>
</div>
