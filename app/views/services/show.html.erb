<div class="main">
  <div class="container">
    <div class="row">

      <!-- Servicio section -->
      <div class="col-lg-7 col-md-8 col-12 order-1 order-md-1 mt-5">
        <!-- ... the rest of your Servicio content ... -->
        <div class="service-show-item">
          <div style="display: flex; justify-content: flex-end;">
            <% if current_user && @service.user_id == current_user.id %>
                <%= button_to edit_service_path(@service), method: :get, class: "btn btn-primary btn-sm me-2" do %>
                    <i class="fa-solid fa-pen-to-square"></i> Editar
                <% end %>
                <%= button_to service_path(@service), method: :delete, class: "btn btn-danger btn-sm", form: { data: { turbo_confirm: "¿Estás seguro de que deseas eliminar este servicio?" }} do %>
                    <i class="fa-solid fa-trash"></i> Eliminar
                <% end %>
            <% end %>
          </div>
            <h3 class="mt-3"><%= @service.title %></h3>
          <div style="display: flex; justify-content: space-between;">
            <div class="star">
              <% if @reviews.present? %>
                <div class="average-rating">
                  <p><%= "⭐️" %> <%= sprintf('%.2f', calculate_average_rating(@reviews)) %></p>
                </div>
              <% else %>
                --
              <% end %>
            </div>
            <div class="like-button">
              <% if current_user %>
                <% if Like.user_and_service(current_user.id, @service.id) %>
                  <%= button_to like_path(service_id: @service.id), method: :delete do %>
                    <span class="fa fa-heart liked-btn"></span>
                  <% end %>
                <% else %>
                  <%= button_to likes_path(service_id: @service.id), method: :post do %>
                    <span class="fa fa-heart unliked-btn"></span>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <%= @service.category&.name || "" %>
          </div>
          <br>
          <div class="service-image">
            <% if @service.image.attached? %>
              <%= image_tag(@service.image, class: "service-image") %>
            <% else %>
              <%= image_tag('default_service.jpg', class: "service-image") %>
            <% end %>
          </div>
          <p><%= simple_format(@service.detail) %></p>
        </div>

        <div class="d-grid gap-2 col-10 mx-auto">
          <%= link_to "Hacer el pedido", new_order_path(seller_id: @service.user_id, service_id: @service.id, buyer_id: current_user&.id), class: "btn btn-success btn-lg" %>
        </div>

        <h3 class="mt-5 mb-4">Evaluación</h3>
          <% if @reviews.any? %>
          <!-- ... the rest of your Evaluación content ... -->
          <div class="row">
            <% @reviews.each do |review| %>
              <div class="col-12 mb-4">
                <div class="card" style="width: 100%;">

                  <div class="card-body">
                    <div class="d-flex align-items-start mb-3">

                      <% if review.user.image.attached? %>
                        <%= image_tag(review.user.image, class: "rounded-circle mr-3", style: "width: 50px; height: 50px;") %>
                      <% else %>
                        <%= image_tag('default_user.jpg', class: "rounded-circle mr-3", style: "width: 50px; height: 50px;") %>
                      <% end %>

                      <div class="flex-grow-1" style="margin-left: 10px;">
                        <h5 style="margin-top: 10px; color: #196F3D;">Servicio: <%= review&.service&.title || 'Este registro ha sido eliminada.' %></h5>
                        <% if review.rating.present? %>
                          <div><%= "⭐️" * review.rating %></div>
                        <% end %>
                        <% if review.user.name.present? %>
                          <p class="font-weight-bold" style="margin-top: 5px; margin-bottom: 5px;"><%= review.user.name %></p>
                        <% else %>
                          <p class="font-weight-bold" style="margin-top: 5px; margin-bottom: 5px;">Usuario dado de baja</p>
                        <% end %>
                        <div class="d-flex justify-content-start" style="font-size: 12px;">
                          <div style="margin-right: 10px;">Creación: <%= review.created_at.strftime("%d/%m/%Y %H:%M") %></div>
                          <div style="margin-bottom: 10px;">Actualización: <%= review.updated_at.strftime("%d/%m/%Y %H:%M") %></div>
                        </div>
                        <p class="mb-0"><%= review.comment %></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          <%= paginate @reviews %>
        <% else %>
          <p>No hay evaluaciones.</p>
        <% end %>
      </div>

      <!-- Vendedor/a section -->
      <div class="col-lg-3 col-md-4 col-12 order-2 order-md-1 mb-5 mt-5">
          <%= link_to user_path(@service.user), class: 'text-decoration-none text-dark' do %>
              <div class="card">
                  <div class="card-body text-center">
                      <% if @service.user.image.attached? %>
                          <%= image_tag(@service.user.image, class: 'rounded-circle mx-auto d-block', style: 'width:100px; height:100px;') %>
                      <% else %>
                          <%= image_tag('default_user.jpg', class: 'rounded-circle mx-auto d-block', style: 'width:100px; height:100px;') %>
                      <% end %>
                      <h6 class="mt-3 mb-1">
                          <%= @service.user.name %>
                      </h6>
                      <% if @service.average_rating > 0 %>
                        <p class="mb-0"><%= "⭐️" %> <%= sprintf('%.2f', @service.average_rating) %></p>
                      <% else %>
                        <p class="mb-0"> -- </p>
                      <% end %>
                  </div>
              </div>
          <% end %>
      </div>


    </div>
  </div>
</div>
